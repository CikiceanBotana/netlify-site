<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bonfish Restaurant</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        .font-playfair { font-family: 'Playfair Display', serif; }
        .font-lato { font-family: 'Lato', sans-serif; }
        .font-great-vibes { font-family: 'Great Vibes', cursive; }
        .bg-skin { background-color: #FDF5E6; }
        .text-gold { color: #C5A572; }
        .border-gold { border-color: #C5A572; }
        .bg-gold { background-color: #C5A572; }
        .hover\:bg-gold-dark:hover { background-color: #B69662; }
        .logo-text { 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }
        .menu-card {
            background-color: #FFFFFF;
            box-shadow: 0 2px 4px rgba(197, 165, 114, 0.1);
            border-bottom: 1px solid rgba(197, 165, 114, 0.2);
        }
        .menu-card:first-child {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .menu-card:last-child {
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            border-bottom: none;
        }
        .menu-details {
            background-color: #FDFAF5;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .menu-details.expanded {
            max-height: 800px;
        }

        .nutritional-table + .nutritional-table {
            margin-top: 2rem;
            border-top: 2px solid rgba(197, 165, 114, 0.2);
            padding-top: 1rem;
        } 

        .details-content {
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease-in-out;
        }
        .details-content.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .nutritional-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: white;
        }
        .nutritional-table td {
            padding: 8px 12px;
            border: 1px solid rgba(197, 165, 114, 0.3);
            text-align: center;
            font-size: 0.9rem;
            color: #333;
        }
        .nutritional-table tr td:first-child {
            background: rgba(197, 165, 114, 0.05);
            font-weight: 500;
            color: #666;
            width: 25%;
            text-align: left;
        }
        .portion-info {
            font-size: 0.85rem;
            color: #666;
            text-align: center;
            margin-bottom: 1rem;
            font-style: italic;
        }
    </style>
</head>
<body class="bg-skin font-lato">
    <div id="root"></div>
    <script>
        // Calculation functions
        const extractNumber = (str) => {
            if (!str) return 0;
            const match = str.match(/\d+/);
            return match ? parseInt(match[0]) : 0;
        };

        const calculatePer100g = (value, portionSize) => {
            if (!value || !portionSize) return '-';
            
            // Handle energy values (e.g., "254/1062")
            if (value.includes('/')) {
                const [kcal, kj] = value.split('/').map(v => extractNumber(v));
                const kcalPer100 = Math.round((kcal * 100) / portionSize);
                const kjPer100 = Math.round((kj * 100) / portionSize);
                return `${kcalPer100}/${kjPer100}`;
            }
            
            // Handle values with slashes (e.g., "14/6")
            if (value.includes('/')) {
                const [val1, val2] = value.split('/').map(v => extractNumber(v));
                const val1Per100 = Math.round((val1 * 100) / portionSize);
                const val2Per100 = Math.round((val2 * 100) / portionSize);
                return `${val1Per100}/${val2Per100}`;
            }

            // Handle simple numeric values
            const numValue = extractNumber(value);
            if (numValue === 0) return '-';
            
            const per100 = Math.round((numValue * 100) / portionSize);
            return `${per100}${value.includes('gr') ? 'gr' : ''}`;
        };

        const processNutritionalInfo = (item) => {
            if (!item || !item.portion) return null;
            
            const portionSize = extractNumber(item.portion);
            if (!portionSize) return null;

            return {
                calories: calculatePer100g(item.nutritionalInfo?.calories, portionSize),
                fats: calculatePer100g(item.nutritionalInfo?.fats, portionSize),
                protein: calculatePer100g(item.nutritionalInfo?.protein, portionSize),
                carbs: calculatePer100g(item.nutritionalInfo?.carbs, portionSize),
                salt: calculatePer100g(item.nutritionalInfo?.salt, portionSize)
            };
        };

        // Table component
        const NutritionalTable = ({ item, per100g = false }) => {
            const values = per100g ? processNutritionalInfo(item) : item.nutritionalInfo;
            const title = per100g ? 'Valori nutriționale per 100g' : `Valori nutriționale per porție (${item.portion})`;

            return React.createElement('div', { className: 'mb-6' }, [
                React.createElement('h5', {
                    className: 'text-center font-playfair text-gray-700 mb-2'
                }, title),
                React.createElement('table', {
                    className: 'nutritional-table',
                }, [
                    React.createElement('tbody', {}, [
                        React.createElement('tr', { key: 'row-1' }, [
                            React.createElement('td', {}, 'Valoare energetică Kcal/kj'),
                            React.createElement('td', { colSpan: '3' }, values?.calories || '-')
                        ]),
                        React.createElement('tr', { key: 'row-2' }, [
                            React.createElement('td', {}, 'Grăsimi/din care lipide saturate'),
                            React.createElement('td', { colSpan: '3' }, values?.fats || '-')
                        ]),
                        React.createElement('tr', { key: 'row-3' }, [
                            React.createElement('td', {}, 'Proteine'),
                            React.createElement('td', { colSpan: '3' }, values?.protein || '-')
                        ]),
                        React.createElement('tr', { key: 'row-4' }, [
                            React.createElement('td', {}, 'Glucide'),
                            React.createElement('td', { colSpan: '3' }, values?.carbs || '-')
                        ]),
                        React.createElement('tr', { key: 'row-5' }, [
                            React.createElement('td', {}, 'Sare'),
                            React.createElement('td', { colSpan: '3' }, values?.salt || '-')
                        ]),
                        !per100g && React.createElement('tr', { key: 'row-6' }, [
                            React.createElement('td', {}, 'Alergeni'),
                            React.createElement('td', { colSpan: '3', className: 'text-red-600' }, item.allergens || '-')
                        ]),
                        !per100g && React.createElement('tr', { key: 'row-7' }, [
                            React.createElement('td', {}, 'Aditivi'),
                            React.createElement('td', { colSpan: '3', className: 'text-orange-600' }, item.additives || '-')
                        ])
                    ].filter(Boolean))
                ])
            ]);
        };

        // Updated MenuItem component
        const MenuItem = ({ item }) => {
            const [isExpanded, setIsExpanded] = React.useState(false);
            const [isContentVisible, setIsContentVisible] = React.useState(false);

            React.useEffect(() => {
                if (isExpanded) {
                    setTimeout(() => setIsContentVisible(true), 50);
                } else {
                    setIsContentVisible(false);
                }
            }, [isExpanded]);

            if (!item) return null;

            return React.createElement('div', { 
                className: "menu-card" 
            }, [
                React.createElement('div', { 
                    key: 'header',
                    className: "flex justify-between items-center p-4" 
                }, [
                    React.createElement('div', { key: 'title' }, [
                        React.createElement('h3', { 
                            key: 'name',
                            className: "text-xl font-playfair font-bold text-gray-800" 
                        }, item.name),
                        React.createElement('p', { 
                            key: 'portion',
                            className: "text-sm text-gold mt-1" 
                        }, `Porție: ${item.portion}`)
                    ]),
                    React.createElement('button', {
                        key: 'button',
                        onClick: () => setIsExpanded(!isExpanded),
                        className: "px-6 py-2 bg-gold text-white rounded-full hover:bg-gold-dark transition-colors font-lato"
                    }, isExpanded ? 'Mai puține detalii' : 'Mai multe detalii')
                ]),
                React.createElement('div', {
                    key: 'details',
                    className: `menu-details ${isExpanded ? 'expanded' : ''}`
                }, React.createElement('div', {
                    className: `details-content ${isContentVisible ? 'visible' : ''} p-6`
                }, [
                    React.createElement('p', {
                        className: 'portion-info',
                        key: 'portion-details'
                    }, item.ingredients),
                    React.createElement(NutritionalTable, { 
                        key: 'main-table',
                        item: item,
                        per100g: false
                    }),
                    React.createElement(NutritionalTable, { 
                        key: 'per100g-table',
                        item: item,
                        per100g: true
                    })
                ]))
            ]);
        };

        const Logo = () => {
            return React.createElement('div', {
                className: "text-center mb-8"
            }, [
                React.createElement('h1', {
                    className: "font-great-vibes text-6xl md:text-7xl text-gold logo-text mb-2"
                }, "Bonfish"),
                React.createElement('div', {
                    className: "flex items-center justify-center gap-4 text-gold"
                }, [
                    React.createElement('span', { className: "border-t border-gold w-16" }),
                    React.createElement('span', { className: "font-playfair text-sm tracking-widest" }, "RESTAURANT"),
                    React.createElement('span', { className: "border-t border-gold w-16" })
                ])
            ]);
        };

        const MenuList = () => {
            const [menuData, setMenuData] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);

            React.useEffect(() => {
                console.log('Fetching menu data...');
                fetch('/menu-items.json')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        setMenuData(Array.isArray(data) ? data : []);
                        setLoading(false);
                    })
                    .catch(error => {
                        console.error('Error loading menu:', error);
                        setError(error.message);
                        setLoading(false);
                    });
            }, []);

            if (loading) {
                return React.createElement('div', {
                    className: "min-h-screen bg-skin flex items-center justify-center"
                }, React.createElement('div', {
                    className: "text-xl text-gold font-playfair"
                }, "Se încarcă meniul..."));
            }

            if (error) {
                return React.createElement('div', {
                    className: "min-h-screen bg-skin flex items-center justify-center"
                }, React.createElement('div', {
                    className: "text-xl text-red-600 font-playfair"
                }, `Eroare: ${error}`));
            }

            return React.createElement('div', {
                className: "min-h-screen bg-skin py-12"
            }, React.createElement('div', {
                className: "container mx-auto px-4 max-w-4xl"
            }, [
                React.createElement(Logo, { key: 'logo' }),
                React.createElement('div', {
                    key: 'menu-description',
                    className: "text-center mb-12"
                }, [
                    React.createElement('p', {
                        className: "text-gray-600 font-lato"
                    }, menuData.length === 0 
                        ? "Nu există încă preparate în meniu."
                        : "Bucătăria noastră vă oferă o experiență culinară deosebită")
                ]),
                React.createElement('div', {
                    key: 'menu-items',
                    className: "shadow-lg rounded-lg overflow-hidden"
                }, menuData.map((item, index) => 
                    React.createElement(MenuItem, { key: index, item: item })
                ))
            ]));
        };

        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(MenuList));
        } catch (error) {
            console.error('Error rendering app:', error);
        }

        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>
</body>
</html>
